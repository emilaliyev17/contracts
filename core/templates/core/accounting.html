{% extends 'core/base.html' %}
{% block content %}
<div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white">
    <div class="px-4 py-8">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-bold mb-2">Accounting</h1>
                <p class="text-purple-100">Invoice reconciliation with QuickBooks</p>
            </div>
            <button onclick="history.back()" 
                    class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-colors duration-200">
                Back
            </button>
        </div>
    </div>
</div>

<div class="p-6">
    <table class="w-full">
        <thead>
            <tr class="border-b bg-gray-50">
                <th class="text-left p-4">Contract Name</th>
                <th class="text-left p-4">Contract Number</th>
                <th class="text-left p-4">Due Date</th>
                <th class="text-left p-4">Invoice#</th>
                <th class="text-right p-4">Amount</th>
                <th class="text-left p-4">QBO Invoice#</th>
                <th class="text-left p-4">QBO Inv Date</th>
                <th class="text-right p-4">QBO Amount</th>
                <th class="text-right p-4">Difference</th>
            </tr>
        </thead>
        <tbody>
            {% for milestone in milestones %}
            <tr class="border-b">
                <td class="p-4">{{ milestone.contract.contract_name }}</td>
                <td class="p-4">{{ milestone.contract.contract_number }}</td>
                <td class="p-4">{{ milestone.due_date|date:"M d, Y" }}</td>
                <td class="p-4">{{ milestone.milestone_name }}</td>
                <td class="p-4 text-right">${{ milestone.amount|floatformat:2 }}</td>
                <td class="p-4">
                    <input type="text" 
                           class="border rounded px-2 py-1 w-32" 
                           placeholder="QBO Invoice#"
                           data-milestone-id="{{ milestone.id }}">
                </td>
                <td class="p-4">
                    <input type="date" 
                           class="border rounded px-2 py-1" 
                           data-milestone-id="{{ milestone.id }}">
                </td>
                <td class="p-4">
                    <input type="number" 
                           step="0.01"
                           class="border rounded px-2 py-1 w-32 text-right qbo-amount" 
                           placeholder="0.00"
                           data-milestone-id="{{ milestone.id }}"
                           data-original-amount="{{ milestone.amount }}">
                </td>
                <td class="p-4 text-right difference">
                    <span id="diff-{{ milestone.id }}">-</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
document.querySelectorAll('.qbo-amount').forEach(input => {
    input.addEventListener('input', function() {
        const milestoneId = this.dataset.milestoneId;
        const originalAmount = parseFloat(this.dataset.originalAmount);
        const qboAmount = parseFloat(this.value) || 0;
        const difference = originalAmount - qboAmount;
        
        const diffElement = document.getElementById('diff-' + milestoneId);
        diffElement.textContent = '$' + difference.toFixed(2);
        
        if (Math.abs(difference) > 0.01) {
            diffElement.style.color = 'red';
        } else {
            diffElement.style.color = 'green';
        }
    });
});
</script>
{% endblock %}
